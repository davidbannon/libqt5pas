# This is a basic workflow to help you get started with Actions

name: Build push events (debug mode)

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the develop branch
on: workflow_dispatch
#  issues:
    # types: [opened, edited] # only do edited so we dont retrigger ourself
#    types: [edited]
      
env:
  SOURCE: 'libQtPas_src'

jobs:
  build:
    name: ${{ matrix.config.name }}
    runs-on: ${{ matrix.config.os }}
    defaults:
      run:
        shell: bash 

    strategy:
      fail-fast: false
      matrix:
        config:
          - os: ubuntu-20.04
            name: 'Linux 64'

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:

    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v3
      with:
        path: '${{ env.SOURCE }}'

    - name: Test if Qt updated
      id: test_updated
      run: echo "update_status=${{ env.SOURCE }}/cbindings/package/scripts/check4update.bash" >> $GITHUB_OUTPUT         
       
#        wget https://raw.githubusercontent.com/davidbannon/libqt6pas/master/cbindings/Qt6Pas.pro
#        grep VER_PAT Qt6Pas.pro >> qt6
#        grep VER_PAT ${{ env.SOURCE }}/cbindings/Qt5Pas.pro >> qt5
#        ls -l
#        diff qt5 qt6 >> diff.text
#        ls -l
        # OK, thats silly but this is just a test, ok?
        
    - name: decide
      run: |
        if [[ ${{ steps.test_updated.outputs.update_status }} == "" ]]; then exit 0; else exit 1; fi
#    - name: Upload the Build Artifact
      # apparently next line contails deprecated use of nodejs 12 ??
#      uses: actions/upload-artifact@v2.2.2
#      with:
#        name: libQtPas
#        path: result.text
        #  ${{ env.SOURCE }}/result.text
